<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Oscillator</title>

	<style>
		html,
		body {
			margin: 0;
			padding: 0;
		}

		canvas {
			display: block;
		}

		.slidecontainer {
			width: 100%;
		}

		.slider {
			-webkit-appearance: none;
			width: 200px;
			height: 15px;
			border-radius: 5px;
			background: #d3d3d3;
			outline: none;
			opacity: 0.7;
			-webkit-transition: .2s;
			transition: opacity .2s;
		}

		.slider:hover {
			opacity: 1;
		}

		.slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 25px;
			height: 25px;
			border-radius: 50%;
			background: #4CAF50;
			cursor: pointer;
		}

		.slider::-moz-range-thumb {
			width: 25px;
			height: 25px;
			border-radius: 50%;
			background: #4CAF50;
			cursor: pointer;
		}

	</style>
</head>

<body>
	<h3>Choose your oscillator</h3>

	<select name="oscillatorType" id="oscillator-type">
		<option value="sine">Sine</option>
		<option value="triangle">Triangle</option>
		<option value="sawtooth">sawtooth</option>
		<option value="square">Square</option>
	</select>

	<div class="slidecontainer">
		<!-- TODO: add accordion for why this range is chosen -->

		<input type="range" min="20" max="20000" value="440" class="slider"
			id="freq">
		<p>Frequency: <span id="freq-reading"></span></p>

		<input type="range" min="0" max="10" value="1" class="slider" id="amp">
		<p>Amplitude: <span id="amp-reading"></span></p>
	</div>

	<button type="button" id="play" data-muted="true">Make some noise</button>

	<script>
		let appInit = false

		const oscillatorType = document.getElementById("oscillator-type").value
		const amp = document.getElementById("amp")
		const freq = document.getElementById("freq")
		const ampReading = document.getElementById("amp-reading")
		const freqReading = document.getElementById("freq-reading")
		const play = document.getElementById('play')

		ampReading.innerHTML = amp.value
		freqReading.innerHTML = freq.value

		amp.oninput = () => {
			ampReading.innerHTML = this.value
		}

		freq.oninput = () => {
			freqReading.innerHTML = this.value
		}

		// startOscillator = () => oscillator.start()
		// stopOscillator = () => oscillator.stop()
		// startOscillator()

		play.addEventListener('click', init)

		function init() {
			if (appInit) { return }

			// create web audio api context
			const AudioContext = window.AudioContext || window.webkitAudioContext
			const audioCtx = new AudioContext()

			// create Oscillator node
			const oscillator = audioCtx.createOscillator()

			oscillator.type = oscillatorType
			oscillator.frequency.setValueAtTime(freq.value, audioCtx.currentTime) // value in hertz
			oscillator.connect(audioCtx.destination)

			play.onclick = () => {
				if (play.getAttribute('data-muted') === 'false') {
					// gainNode.disconnect(audioCtx.destination)
					play.setAttribute('data-muted', 'true')
					play.innerHTML = "Make some noise"
				} else {
					// gainNode.connect(audioCtx.destination)
					play.setAttribute('data-muted', 'false')
					play.innerHTML = "Mute"
				};
			}

			isAppInit = true;
		}
	</script>
</body>

</html>
